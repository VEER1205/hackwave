<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>
      TradeX India — Virtual Trading (Stocks | IPO | Crypto | Mutual Funds)
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@4.0.1/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="CSS/trading.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-logo">
          <i class="fas fa-chart-line"></i>
          <span>TradeMaster Pro</span>
        </div>

        <div class="nav-menu" id="navMenu">
          <a href="/landing" class="nav-link active">Home</a>
          <a href="/dashboard" class="nav-link">Dashboard</a>
          <a href="/trading" class="nav-link">Trading</a>
          <a href="/chatbot" class="nav-link">AI Assistant</a>
          <a href="/Quiz" class="nav-link">Daily Quiz</a>
          <a href="/course" class="nav-link">Courses</a>
        </div>

        <div class="nav-actions">
          <a href="/login">
            <button class="btn-primary">Get Started</button>
          </a>

          <div class="mobile-toggle" id="mobileToggle">
            <i class="fas fa-bars"></i>
          </div>
        </div>
      </div>
    </nav>

    <div class="app">
      <!-- Header -->
      <div class="header">
        <div class="brand">
          <div class="brand-badge">TM</div>
          <div>
            <div class="brand-title">Trade Master Pro</div>
            <div class="sub">
              Virtual trading • Stocks • IPO • Crypto • Mutual Funds
            </div>
          </div>
        </div>

        <div class="balance" id="balanceSummary">
          <div class="stat">
            <div class="stat-label">Virtual Balance</div>
            <div class="stat-value" id="statBalance">₹0</div>
          </div>
          <div class="stat">
            <div class="stat-label">Invested Value</div>
            <div class="stat-value" id="statInvested">₹0</div>
          </div>
          <div class="stat">
            <div class="stat-label">Total P&L</div>
            <div class="stat-value" id="statPL">₹0</div>
          </div>
        </div>

        <div class="login" id="loginBox">
          <input class="input" id="nameInput" placeholder="Your name" />
          <button class="btn" id="startBtn">Start</button>
        </div>

        <div class="login" id="userBox" style="display: none">
          <span class="chip" id="userTag">Hi</span>
          <button
            class="btn alt"
            id="resetBtn"
            title="Reset virtual money + portfolio"
          >
            Reset
          </button>
          <button class="btn danger" id="logoutBtn">Logout</button>
        </div>
      </div>

      <!-- Index Bar: NIFTY 50 • SENSEX • BANKNIFTY -->
      <div class="index-bar" id="indexBar">
        <div class="muted">Loading indices...</div>
      </div>

      <!-- Tabs -->
      <div class="tabs" id="tabs">
        <button class="tab active" data-tab="stocks">Stocks</button>
        <button class="tab" data-tab="crypto">Crypto</button>
        <button class="tab" data-tab="mf">Mutual Funds</button>
        <button class="tab" data-tab="ipo">IPO</button>
        <button class="tab" data-tab="portfolio">Portfolio</button>
      </div>

      <div class="grid">
        <!-- Left: Main content -->
        <div class="panel">
          <!-- Stocks -->
          <div class="tab-pane" id="tab-stocks">
            <div class="panel-title">
              <span>Stocks (India)</span>
              <span class="muted" id="dataMode">Data: Demo</span>
            </div>

            <!-- Search and quick add -->
            <div class="search">
              <input
                class="input"
                id="stockSearch"
                placeholder="Search NSE/BSE stocks (e.g., RELIANCE, TCS, INFY, HDFCBANK, ICICIBANK, SBIN...)"
              />
              <button class="btn alt" id="addWatchBtn" title="Add to Watchlist">
                + Watch
              </button>
              <button class="btn alt" id="addWishBtn" title="Add to Wishlist">
                ❤ Wishlist
              </button>
            </div>

            <!-- Prediction Bar -->
            <div class="predictions">
              <div class="pred-head">
                <div class="title-xl">Prediction Bar</div>
                <div style="display: flex; gap: 8px; align-items: center">
                  <span class="muted" style="font-size: 12px"
                    >Momentum + Trend + Volatility scoring (demo)</span
                  >
                  <button class="btn ghost" id="refreshPred">Refresh</button>
                </div>
              </div>
              <div id="predList" class="pred-list">
                <div class="muted">Loading predictions...</div>
              </div>
            </div>

            <!-- Chart and trade -->
            <div class="chart-wrap">
              <div class="chart-head">
                <div>
                  <div class="title-xl" id="assetTitle">—</div>
                  <div class="muted" id="assetSubtitle">Select a symbol</div>
                </div>
                <div style="text-align: right">
                  <div class="price" id="assetPrice">₹0</div>
                  <div id="assetChange" class="muted">0.00% (—)</div>
                </div>
              </div>

              <div class="periods" id="periodButtons">
                <button class="pill active" data-period="1M">1M</button>
                <button class="pill" data-period="3M">3M</button>
                <button class="pill" data-period="6M">6M</button>
                <button class="pill" data-period="1Y">1Y</button>
                <button class="pill" data-period="3Y">3Y</button>
                <button class="pill" data-period="MAX">Max</button>
                <button class="pill" id="wishFromHeader">
                  ❤ Add to Wishlist
                </button>
              </div>

              <div id="chart" style="height: 360px; margin-top: 8px"></div>

              <div class="trade">
                <div class="box">
                  <div class="row">
                    <div>
                      <div class="k">Type</div>
                      <div class="v">Stock (IN)</div>
                    </div>
                    <div>
                      <div class="k">Symbol</div>
                      <div class="v" id="tradeSymbol">—</div>
                    </div>
                  </div>
                  <div class="row" style="margin-top: 8px">
                    <div>
                      <div class="k">LTP</div>
                      <div class="v" id="tradeLTP">₹0</div>
                    </div>
                    <div>
                      <div class="k">Est. Fee</div>
                      <div class="v">₹0 (virtual)</div>
                    </div>
                  </div>
                  <div class="qty" style="margin-top: 10px">
                    <input
                      id="qtyInput"
                      type="number"
                      min="1"
                      step="1"
                      value="1"
                    />
                    <button class="btn alt" id="maxBtn">Max</button>
                  </div>
                  <div class="row" style="margin-top: 10px">
                    <div>
                      <div class="k">Total</div>
                      <div class="v" id="tradeTotal">₹0</div>
                    </div>
                    <div>
                      <div class="k">Balance</div>
                      <div class="v" id="tradeBalance">₹0</div>
                    </div>
                  </div>
                  <div class="actions" style="margin-top: 10px">
                    <button class="btn buy" id="buyBtn">Buy</button>
                    <button class="btn sell" id="sellBtn">Sell</button>
                  </div>
                  <div class="note" style="margin-top: 8px">
                    Projections (last 1Y approx): <span id="projection">—</span>
                  </div>
                </div>

                <div class="box">
                  <div class="row">
                    <div>
                      <div class="k">Monthly</div>
                      <div class="v" id="g1m">—</div>
                    </div>
                    <div>
                      <div class="k">Quarterly</div>
                      <div class="v" id="g3m">—</div>
                    </div>
                  </div>
                  <div class="row" style="margin-top: 8px">
                    <div>
                      <div class="k">Half-year</div>
                      <div class="v" id="g6m">—</div>
                    </div>
                    <div>
                      <div class="k">Yearly</div>
                      <div class="v" id="g1y">—</div>
                    </div>
                  </div>
                  <div class="row" style="margin-top: 8px">
                    <div>
                      <div class="k">3 Years</div>
                      <div class="v" id="g3y">—</div>
                    </div>
                    <div>
                      <div class="k">YTD</div>
                      <div class="v" id="gytd">—</div>
                    </div>
                  </div>
                  <div class="note">
                    Use Prediction Bar above for ideas (demo scoring).
                  </div>
                </div>
              </div>
            </div>

            <div class="panel" style="margin-top: 12px">
              <div class="panel-title">
                <span>Orders (Latest)</span>
                <span class="muted" id="ordersCount">0</span>
              </div>
              <div id="ordersList" class="list"></div>
            </div>
          </div>

          <!-- Crypto -->
          <div class="tab-pane" id="tab-crypto" style="display: none">
            <div class="panel-title">
              <span>Crypto (INR)</span>
              <span class="muted">Source: CoinGecko (free)</span>
            </div>

            <div class="search">
              <input
                class="input"
                id="cryptoSearch"
                placeholder="Search crypto (BTC, ETH, MATIC)"
              />
              <button class="btn alt" id="addWatchCrypto">+ Watch</button>
            </div>

            <div class="chart-wrap">
              <div class="chart-head">
                <div>
                  <div class="title-xl" id="cryptoTitle">—</div>
                  <div class="muted" id="cryptoSubtitle">Select a coin</div>
                </div>
                <div style="text-align: right">
                  <div class="price" id="cryptoPrice">₹0</div>
                  <div id="cryptoChange" class="muted">0.00% (—)</div>
                </div>
              </div>

              <div class="periods" id="cryptoPeriodButtons">
                <button class="pill active" data-period="1M">1M</button>
                <button class="pill" data-period="3M">3M</button>
                <button class="pill" data-period="6M">6M</button>
                <button class="pill" data-period="1Y">1Y</button>
                <button class="pill" data-period="MAX">Max</button>
              </div>

              <div
                id="cryptoChart"
                style="height: 360px; margin-top: 8px"
              ></div>
              <div class="note" id="cryptoPatterns">Patterns: —</div>

              <div class="trade">
                <div class="box">
                  <div class="row">
                    <div>
                      <div class="k">Type</div>
                      <div class="v">Crypto</div>
                    </div>
                    <div>
                      <div class="k">Symbol</div>
                      <div class="v" id="cryptoSymbol">—</div>
                    </div>
                  </div>
                  <div class="row" style="margin-top: 8px">
                    <div>
                      <div class="k">LTP</div>
                      <div class="v" id="cryptoLTP">₹0</div>
                    </div>
                    <div>
                      <div class="k">Est. Fee</div>
                      <div class="v">₹0 (virtual)</div>
                    </div>
                  </div>
                  <div class="qty" style="margin-top: 10px%">
                    <input
                      id="cryptoQty"
                      type="number"
                      min="0.0001"
                      step="0.0001"
                      value="0.01"
                    />
                    <button class="btn alt" id="cryptoMax">Max</button>
                  </div>
                  <div class="row" style="margin-top: 10px">
                    <div>
                      <div class="k">Total</div>
                      <div class="v" id="cryptoTotal">₹0</div>
                    </div>
                    <div>
                      <div class="k">Balance</div>
                      <div class="v" id="cryptoBalance">₹0</div>
                    </div>
                  </div>
                  <div class="actions" style="margin-top: 10px">
                    <button class="btn buy" id="cryptoBuy">Buy</button>
                    <button class="btn sell" id="cryptoSell">Sell</button>
                  </div>
                </div>

                <div class="box">
                  <div class="row">
                    <div>
                      <div class="k">24h Change</div>
                      <div class="v" id="c24">—</div>
                    </div>
                    <div>
                      <div class="k">7d</div>
                      <div class="v" id="c7d">—</div>
                    </div>
                  </div>
                  <div class="row" style="margin-top: 8px">
                    <div>
                      <div class="k">30d</div>
                      <div class="v" id="c30d">—</div>
                    </div>
                    <div>
                      <div class="k">1Y</div>
                      <div class="v" id="c1y">—</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="panel" style="margin-top: 12px">
              <div class="panel-title">
                <span>Crypto Orders (Latest)</span>
                <span class="muted" id="cryptoOrdersCount">0</span>
              </div>
              <div id="cryptoOrdersList" class="list"></div>
            </div>

            <div class="panel" style="margin-top: 12px">
              <div class="panel-title">
                <span>Crypto Recommendations</span>
                <button class="btn ghost" id="refreshCryptoReco">
                  Refresh
                </button>
              </div>
              <div id="cryptoRecoList" class="list"></div>
            </div>
          </div>

          <!-- Mutual Funds -->
          <div class="tab-pane" id="tab-mf" style="display: none">
            <div class="panel-title">
              <span>Mutual Funds (INR)</span>
              <span class="muted">Demo OHLC (candlestick)</span>
            </div>

            <div class="search">
              <input
                class="input"
                id="mfSearch"
                placeholder="Search mutual funds (e.g., HDFCBAL, SBI-SMALLCAP, PARAGFLEXI)"
              />
              <button class="btn alt" id="addWatchMF">+ Watch</button>
              <button class="btn alt" id="addWishMF">❤ Wishlist</button>
            </div>

            <div class="chart-wrap">
              <div class="chart-head">
                <div>
                  <div class="title-xl" id="mfTitle">—</div>
                  <div class="muted" id="mfSubtitle">Select a mutual fund</div>
                </div>
                <div style="text-align: right">
                  <div class="price" id="mfPrice">₹0</div>
                  <div id="mfChange" class="muted">0.00% (—)</div>
                </div>
              </div>

              <div class="periods" id="mfPeriodButtons">
                <button class="pill active" data-period="1M">1M</button>
                <button class="pill" data-period="3M">3M</button>
                <button class="pill" data-period="6M">6M</button>
                <button class="pill" data-period="1Y">1Y</button>
                <button class="pill" data-period="3Y">3Y</button>
                <button class="pill" data-period="MAX">Max</button>
                <button class="pill" id="mfWishFromHeader">
                  ❤ Add to Wishlist
                </button>
              </div>

              <div id="mfChart" style="height: 360px; margin-top: 8px"></div>
              <div class="note" id="mfPatterns">Patterns: —</div>

              <div class="trade">
                <div class="box">
                  <div class="row">
                    <div>
                      <div class="k">Type</div>
                      <div class="v">Mutual Fund</div>
                    </div>
                    <div>
                      <div class="k">Symbol</div>
                      <div class="v" id="mfSymbol">—</div>
                    </div>
                  </div>
                  <div class="row" style="margin-top: 8px">
                    <div>
                      <div class="k">LTP</div>
                      <div class="v" id="mfLTP">₹0</div>
                    </div>
                    <div>
                      <div class="k">Est. Fee</div>
                      <div class="v">₹0 (virtual)</div>
                    </div>
                  </div>
                  <div class="qty" style="margin-top: 10px">
                    <input
                      id="mfQty"
                      type="number"
                      min="0.01"
                      step="0.01"
                      value="1.00"
                    />
                    <button class="btn alt" id="mfMax">Max</button>
                  </div>
                  <div class="row" style="margin-top: 10px">
                    <div>
                      <div class="k">Total</div>
                      <div class="v" id="mfTotal">₹0</div>
                    </div>
                    <div>
                      <div class="k">Balance</div>
                      <div class="v" id="mfBalance">₹0</div>
                    </div>
                  </div>
                  <div class="actions" style="margin-top: 10px">
                    <button class="btn buy" id="mfBuy">Buy</button>
                    <button class="btn sell" id="mfSell">Sell</button>
                  </div>
                </div>

                <div class="box">
                  <div class="k">Tip</div>
                  <div class="note">
                    This is a demo candlestick for MFs (real MFs typically have
                    daily NAV). Use periods to view trend.
                  </div>
                </div>
              </div>
            </div>

            <div class="panel" style="margin-top: 12px">
              <div class="panel-title">
                <span>Mutual Fund Orders (Latest)</span>
                <span class="muted" id="mfOrdersCount">0</span>
              </div>
              <div id="mfOrdersList" class="list"></div>
            </div>

            <div class="panel" style="margin-top: 12px">
              <div class="panel-title">
                <span>MF Recommendations</span>
                <button class="btn ghost" id="refreshMFReco">Refresh</button>
              </div>
              <div id="mfRecoList" class="list"></div>
            </div>
          </div>

          <!-- IPO -->
          <div class="tab-pane" id="tab-ipo" style="display: none">
            <div class="panel-title">
              <span>IPO (Virtual Apply)</span>
              <span class="muted"
                >Mock flow. Link to broker APIs for actual UPI-based IPO
                apply.</span
              >
            </div>

            <div class="grid-3" id="ipoList"></div>

            <div class="panel" style="margin-top: 12px">
              <div class="panel-title">
                <span>IPO Applications</span>
                <span class="muted" id="ipoOrdersCount">0</span>
              </div>
              <div id="ipoOrdersList" class="list"></div>
            </div>
          </div>

          <!-- Portfolio -->
          <div class="tab-pane" id="tab-portfolio" style="display: none">
            <div class="panel-title">
              <span>Portfolio</span>
              <span class="muted">Your holdings & P/L</span>
            </div>

            <!-- Performance charts -->
            <div class="panel" style="margin-bottom: 12px">
              <div class="panel-title">
                <span>Performance</span>
                <span class="muted" id="perfSummary"
                  >Month P&L: — | YTD: —</span
                >
              </div>
              <div class="row" style="grid-template-columns: 1fr 1fr">
                <div class="box" style="height: 280px">
                  <div class="k">Current Month P&L (Daily)</div>
                  <div
                    id="equityMonthChart"
                    style="height: 220px; margin-top: 6px"
                  ></div>
                </div>
                <div class="box" style="height: 280px">
                  <div class="k">YTD Cumulative P&L</div>
                  <div
                    id="equityYTDChart"
                    style="height: 220px; margin-top: 6px"
                  ></div>
                </div>
              </div>
            </div>

            <div class="panel" style="margin-bottom: 12px">
              <table id="portfolioTable">
                <thead>
                  <tr>
                    <th>Asset</th>
                    <th>Type</th>
                    <th>Qty</th>
                    <th>Avg Cost</th>
                    <th>LTP</th>
                    <th>P&L</th>
                    <th>Value</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="panel">
              <div class="panel-title">
                <span>Trade History</span>
                <button class="btn alt" id="exportBtn">Export JSON</button>
              </div>
              <div id="historyList" class="list"></div>
            </div>
          </div>
        </div>

        <!-- Right: Sidebar (Watchlist + Wishlist) -->
        <div class="panel">
          <div class="lists-header">
            <span class="title-xl">Lists</span>
            <button class="btn alt" id="clearAllLists">Clear All</button>
          </div>

          <div class="section-title">Watchlist</div>
          <div id="watchlist" class="list" style="margin-bottom: 10px"></div>
          <button class="btn ghost" id="clearWatch">Clear Watchlist</button>

          <div class="section-title" style="margin-top: 16px">Wishlist</div>
          <div id="wishlist" class="list" style="margin-bottom: 10px"></div>
          <button class="btn ghost" id="clearWish">Clear Wishlist</button>

          <div class="section-title" style="margin-top: 16px">MF Watchlist</div>
          <div id="mfWatchlist" class="list" style="margin-bottom: 10px"></div>
          <button class="btn ghost" id="clearMFWatch">
            Clear MF Watchlist
          </button>

          <div class="section-title" style="margin-top: 16px">MF Wishlist</div>
          <div id="mfWishlist" class="list" style="margin-bottom: 10px"></div>
          <button class="btn ghost" id="clearMFWish">Clear MF Wishlist</button>
        </div>
      </div>

      <div class="muted" style="margin-top: 10px; font-size: 12px">
        Demo mode shows limited symbols. Connect a backend with Upstox/Zerodha
        SmartAPI/Kite Connect for real-time Indian quotes and full symbol
        coverage. Educational use only.
      </div>
    </div>

    <script src="JS/trading.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- SweetAlert2 Alerts (API style from 1st snippet) -->
    <script>
       <% if (errors && errors.length > 0) { %>
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: "<%= errors.join('\\n') %>"
        });
      <% } else if (success && success.length > 0) { %>
        Swal.fire({
          icon: 'success',
          title: 'Success!',
          text: "<%= success.join('\\n') %>"
        });
      <% } %>
    </script>
  </body>
</html>
